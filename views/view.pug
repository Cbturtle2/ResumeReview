extends layout

mixin deleteButton(comment)
  if user.preferred_username === comment.author
    a(data-parent=comment.id, onclick='deleteComment(event)', href='#', class='btn btn-sm btn-danger') Delete

mixin displayComment(comment, isResponse)
  if isResponse
    li.list-group-item.comment.response
      img(src='https://profiles.csh.rit.edu/image/' + comment.author, class='profile')
      strong #{comment.author}
      | : 
      | #{comment.body}
      span.badge.badge-primary.badge-pill #{moment(comment.date + ' +0000').fromNow()}
      +deleteButton(comment)
  else
    li.list-group-item.comment
      img(src='https://profiles.csh.rit.edu/image/' + comment.author, class='profile')
      strong #{comment.author}
      | : 
      | #{comment.body}
      span.badge.badge-primary.badge-pill #{moment(comment.date + ' +0000').fromNow()}
      a(data-parent=comment.id, onclick='reply(event)', href='#', class='btn btn-sm btn-info') Reply
      +deleteButton(comment)

block content
  .container
    .row
      .col-12
        h2
          strong #{resume.filename}
        p
          img(src='https://profiles.csh.rit.edu/image/' + resume.author, class='profile')
          strong #{resume.author} 
          | posted this 
          | #{moment(resume.date + ' +0000').fromNow()}.
        if isOwner
          a(href="/resumes/delete/" + resume.id, class='btn btn-danger deleteResume') Delete this file
        iframe(src=url, class="preview")
      .col-12
        each comment in comments
          ul.list-group
            +displayComment(comment, false)
            each child in comment.children
              +displayComment(child, true)
      .col-12
        form
          input(name='parent_id', type='text', value=resume.id, readonly, hidden)
          input(name='body', type='text', placeholder='New comment')
          input(type='button', value='Post', onclick="sendComment(event)", class='btn btn-primary')

block footer
  script(src='/javascripts/view.js')